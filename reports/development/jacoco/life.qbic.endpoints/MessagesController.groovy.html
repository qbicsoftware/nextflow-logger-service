<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MessagesController.groovy</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">flowstore</a> &gt; <a href="index.source.html" class="el_package">life.qbic.endpoints</a> &gt; <span class="el_source">MessagesController.groovy</span></div><h1>MessagesController.groovy</h1><pre class="source lang-java linenums">package life.qbic.endpoints

import groovy.util.logging.Log4j2
import io.micronaut.http.HttpResponse
import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Body
import io.micronaut.http.annotation.Consumes
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.http.annotation.Post
import io.micronaut.security.annotation.Secured
import life.qbic.Contact
import life.qbic.model.WeblogMessage
import life.qbic.model.weblog.MetaData
import life.qbic.model.weblog.RunInfo
import life.qbic.model.weblog.Trace
import life.qbic.service.WorkflowService

import javax.inject.Inject

@Log4j2
@Controller(&quot;/workflows&quot;)
class MessagesController {

    WorkflowService informationCenter

    private Contact contact

    @Inject MessagesController(WorkflowService informationCenter, Contact contact) {
<span class="nc" id="L30">        this.informationCenter = informationCenter</span>
<span class="nc" id="L31">        this.contact = contact</span>
<span class="nc" id="L32">    }</span>

    @Consumes(MediaType.APPLICATION_JSON)
    @Post(uri=&quot;/&quot;)
    HttpResponse storeWeblogMessage(@Body String message) {
<span class="nc" id="L37">        WeblogMessage weblogMessage</span>
        try {
<span class="nc" id="L39">            weblogMessage = WeblogMessage.createFromJson(message)</span>
<span class="nc bnc" id="L40" title="All 2 branches missed.">            log.info &quot;Incoming weblog message with for run ID: ${weblogMessage.runInfo.id}&quot;</span>
<span class="nc" id="L41">            informationCenter.storeWeblogMessage(weblogMessage)</span>
<span class="nc" id="L42">        } catch ( Exception e ) {</span>
<span class="nc" id="L43">            log.error(e)</span>
<span class="nc bnc" id="L44" title="All 2 branches missed.">            log.debug(e.printStackTrace())</span>
<span class="nc" id="L45">            return HttpResponse.serverError(&quot;Unexpected error, resource could not be created.&quot;)</span>
<span class="nc" id="L46">        }</span>
<span class="nc" id="L47">        return HttpResponse.created(new URI(&quot;/workflows/info/${weblogMessage.runInfo.id}&quot;))</span>
<span class="nc" id="L48">    }</span>

    @Secured(&quot;READER&quot;)
    @Get(&quot;/info/{runId}&quot;)
    HttpResponse getBasicWorkflowInformation(String runId) {
<span class="nc bnc" id="L53" title="All 2 branches missed.">        log.info &quot;Resource request for runId: $runId.&quot;</span>
<span class="nc" id="L54">        List&lt;RunInfo&gt; runInfoList</span>
        try {
<span class="nc" id="L56">            runInfoList = informationCenter.getWorkflowRunInfoForId(runId)</span>
<span class="nc" id="L57">        } catch ( Exception e ) {</span>
<span class="nc" id="L58">            log.error(e)</span>
<span class="nc bnc" id="L59" title="All 4 branches missed.">            return HttpResponse.serverError(serverErrorResponse())</span>
<span class="nc" id="L60">        }</span>
<span class="nc bnc" id="L61" title="All 2 branches missed.">        runInfoList ? HttpResponse.ok(runInfoList): HttpResponse.notFound()</span>
<span class="nc" id="L62">    }</span>

    @Secured(&quot;READER&quot;)
    @Get(&quot;/traces/{runId}&quot;)
    HttpResponse&lt;List&lt;Trace&gt;&gt; getTracesForWorkflow(String runId) {
<span class="nc bnc" id="L67" title="All 2 branches missed.">        log.info &quot;Traces request for runId: $runId.&quot;</span>
<span class="nc" id="L68">        List&lt;Trace&gt; traces</span>
        try {
<span class="nc" id="L70">            traces = informationCenter.getTracesForWorkflowWithId(runId)</span>
<span class="nc" id="L71">        } catch( Exception e ) {</span>
<span class="nc" id="L72">            log.error(e)</span>
<span class="nc" id="L73">            return HttpResponse.serverError()</span>
<span class="nc" id="L74">        }</span>
<span class="nc bnc" id="L75" title="All 2 branches missed.">        traces ? HttpResponse.ok(traces) : HttpResponse.notFound(traces)</span>
<span class="nc" id="L76">    }</span>

    @Secured(&quot;READER&quot;)
    @Get(&quot;/metadata/{runId}&quot;)
    HttpResponse&lt;List&lt;MetaData&gt;&gt; getMetaDataForWorkflow(String runId) {
<span class="nc bnc" id="L81" title="All 2 branches missed.">        log.info &quot;Metadata request for runId: $runId.&quot;</span>
<span class="nc" id="L82">        List&lt;MetaData&gt; metaData</span>
        try {
<span class="nc" id="L84">            metaData = informationCenter.getMetadataOfWorkflow(runId)</span>
<span class="nc" id="L85">        } catch( Exception e ) {</span>
<span class="nc" id="L86">            log.error(e)</span>
<span class="nc" id="L87">            return HttpResponse.serverError()</span>
<span class="nc" id="L88">        }</span>
<span class="nc bnc" id="L89" title="All 2 branches missed.">        metaData ? HttpResponse.ok(metaData) : HttpResponse.notFound(metaData)</span>

<span class="nc" id="L91">    }</span>

    @Secured(&quot;isAnonymous()&quot;)
    @Get(&quot;/&quot;)
    HttpResponse&lt;List&lt;RunInfo&gt;&gt; getAllRunInfoForWorkflows() {
<span class="nc" id="L96">        log.info &quot;Complete run info request.&quot;</span>
<span class="nc" id="L97">        List&lt;RunInfo&gt; runInfoList</span>
        try {
<span class="nc" id="L99">            runInfoList = informationCenter.getAllWorkflowRunInfo()</span>
<span class="nc" id="L100">        } catch ( Exception e ) {</span>
<span class="nc" id="L101">            log.error(e)</span>
<span class="nc" id="L102">            return HttpResponse.serverError()</span>
<span class="nc" id="L103">        }</span>
<span class="nc bnc" id="L104" title="All 2 branches missed.">        runInfoList ? HttpResponse.ok(runInfoList) : HttpResponse.notFound(runInfoList)</span>
<span class="nc" id="L105">    }</span>

    static String serverErrorResponse() {
<span class="nc" id="L108">        &quot;Unexpected error, resource could not be accessed.&quot;</span>
<span class="nc" id="L109">    }</span>


}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.3.201901230119</span></div></body></html>